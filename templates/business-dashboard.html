<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Business Dashboard</title>
    <link href="/static/styles.css" rel="stylesheet">
</head>
<body>
    <div class="dashboard-container">
        <header>
            <h1>Business Dashboard</h1>
            <div class="user-section">
                <span id="userName"></span>
                <button onclick="logout()">Logout</button>
            </div>
        </header>
        
        <main>
            <div id="userInfo" class="user-info">
                <h2>Business Profile</h2>
                <p>Name: <span id="userName2"></span></p>
                <p>Email: <span id="userEmail"></span></p>
                <div class="user-section">
                    <span id="userName"></span>
                    <button onclick="createProfile()">create profile</button>
                </div>
            </div>

            <div class="dashboard-actions">
                <h2>Business Management</h2>
                <div class="action-grid">
                    <div class="action-card">
                        <h3>Manage Services</h3>
                        <div class="user-section">
                            <span id="userName"></span>
                            <button onclick="addServices()">Add Service</button>
                        </div>
                        <p>Edit and remove services</p>
                    </div>
                    <div class="action-card">
                        <h3>View Bookings</h3>
                        <p>Track your appointments</p>
                    </div>
                    <div class="action-card">
                        <h3>Customer Insights</h3>
                        <p>Analyze customer data</p>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        // Load user info on page load
        document.addEventListener('DOMContentLoaded', async () => {
            try {
                const response = await fetch('/api/profile', {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    credentials: 'include' // Important for cookies
                });

                if (!response.ok) {
                    throw new Error('Failed to fetch profile');
                }

                const userData = await response.json();
                document.getElementById('userName').textContent = userData.name || 'Business Owner';
                document.getElementById('userName2').textContent = userData.name || 'Business Owner';
                document.getElementById('userEmail').textContent = userData.email || 'N/A';
            } catch (error) {
                console.error('Profile fetch error:', error);
                window.location.href = '/login';
            }
        });

        // Logout functionality
        async function logout() {
            try {
                await fetch('/api/auth/logout', { 
                    method: 'POST',
                    credentials: 'include' // Important for cookies
                });
                window.location.href = '/login';
            } catch (error) {
                console.error('Logout failed:', error);
                window.location.href = '/login';
            }
        }
        function createProfile() {
            window.location.href = '/create-profile';
        }
        function addServices() {
            window.location.href = '/add-service';
        }
    </script>
</body>
</html>