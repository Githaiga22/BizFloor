<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Customer Dashboard</title>
    <link href="/static/styles.css" rel="stylesheet">
</head>
<body>
    <div class="dashboard-container">
        <header>
            <h1>Welcome, <span id="userName"></span></h1>
            <button onclick="logout()">Logout</button>
        </header>
        
        <main>
            <div id="userInfo" class="user-info">
                <h2>Your Profile</h2>
                <p>Email: <span id="userEmail"></span></p>
            </div>

            <div class="dashboard-actions">
                <h2>Customer Actions</h2>
                <p>More features coming soon!</p>
            </div>
        </main>
    </div>

    <script>
        // Load user info on page load
        document.addEventListener('DOMContentLoaded', async () => {
            try {
                const response = await fetch('/api/profile', {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    credentials: 'include'
                });

                if (!response.ok) {
                    throw new Error('Failed to fetch profile');
                }

                const userData = await response.json();
                document.getElementById('userName').textContent = userData.name || 'User';
                document.getElementById('userEmail').textContent = userData.email || 'N/A';
            } catch (error) {
                console.error('Profile fetch error:', error);
                window.location.href = '/login';
            }
        });

        // Logout functionality
        async function logout() {
            try {
                await fetch('/api/auth/logout', { 
                    method: 'POST',
                    credentials: 'include' 
                });
                window.location.href = '/login';
            } catch (error) {
                console.error('Logout failed:', error);
                window.location.href = '/login';
            }
        }
    </script>
</body>
</html>